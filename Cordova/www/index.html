<!DOCTYPE html>
<html>
    <head>

        <link rel="stylesheet" type="text/css" href="css/index.css">
        <title>Hello World</title>
        
    </head>
    <body>
        <div class="app">
            
            <div class="button-container">
                <button class="button-wrapper button" id="act1"></button>
                <button class="button-wrapper button" id="act2"></button>
                <button class="button-wrapper button" id="act3"></button>
                <button class="button-wrapper button" id="act4"></button>
                <button class="button-wrapper button" id="act5"></button>
                <button class="button-wrapper button" id="act6"></button>
             </div>

        </div>
        
        <script type="text/javascript" src="cordova.js"></script>
        <script type="text/javascript" src="socket.js"></script>
        <script>
            
            document.addEventListener('touchmove', function(e) { e.preventDefault(); }, false);
            
            for (let i = 1; i <= 6; i++) {
                var elem = document.getElementById("act"+i);
                elem.innerHTML = i;
                elem.addEventListener("touchstart", function(){ onPressedEvent(i); } );
                elem.addEventListener("touchend", function(){ onReleasedEvent(i); } );
                
            }                
            
            var onPressedEvent = function(key) {
                if (socket.state == Socket.State.OPENED) {
                    var dataString = key +";"+ 0;
                    var data = new Uint8Array(dataString.length);
                    for (var i = 0; i < data.length; i++) {
                        data[i] = dataString.charCodeAt(i);
                    }
                    socket.write(data);
                }
            };
            
            var onReleasedEvent = function(key) {
                if (socket.state == Socket.State.OPENED) {
                    var dataString = key +";"+ 1;
                    var data = new Uint8Array(dataString.length);
                    for (var i = 0; i < data.length; i++) {
                        data[i] = dataString.charCodeAt(i);
                    }
                    socket.write(data);
                }
            };
            
            var socket = null;

            var onDeviceReady = function() {
                console.log("device   ready");

                socket = new Socket();

                socket.onData = function(data) {
                  // invoked after new batch of data is received (typed array of bytes Uint8Array)
                };
                socket.onError = function(errorMessage) {
                  // invoked after error occurs during connection
                };
                socket.onClose = function(hasError) {
                  // invoked after connection close
                };

                socket.open(
                    "192.168.1.33", 
                    23997,
                    function() {
                        console.log("connected");
                    },
                    function(errorMessage) {
                      // invoked after unsuccessful opening of socket
                      console.log(errorMessage);
                    }
                );
            };


            document.addEventListener('deviceready', onDeviceReady);


        </script>

    </body>
</html>
